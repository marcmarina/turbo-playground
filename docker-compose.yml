services:
  # External-facing service with published port
  express-app-external:
    image: turbo-playground:latest
    command: node apps/express-app
    networks:
      - shared-network
    env_file:
      - apps/express-app/.env
    ports:
      - "8080:8080"
    deploy:
      replicas: 1
      update_config:
        delay: 5s
        parallelism: 1
        order: start-first


  express-app-internal:
    image: turbo-playground:latest
    command: node apps/express-app
    networks:
      - shared-network
    env_file:
      - apps/express-app/.env
    deploy:
      replicas: 3
      update_config:
        delay: 5s
        parallelism: 1
        order: start-first

networks:
  shared-network:
    external: true
